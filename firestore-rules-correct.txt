# üîí Regras de Seguran√ßa do Firestore - CORRIGIDAS

# ‚ö†Ô∏è IMPORTANTE: Estas regras permitem escrita p√∫blica na cole√ß√£o feedbacks
# Isso √© necess√°rio para que clientes possam enviar feedbacks sem autentica√ß√£o

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Usu√°rios: usu√°rios podem ler/escrever apenas seus pr√≥prios dados
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // √Åreas: usu√°rios podem ler/escrever apenas suas pr√≥prias √°reas
    match /areas/{areaId} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }
    
    // Feedbacks: PERMITE ESCRITA P√öBLICA (sem autentica√ß√£o)
    match /feedbacks/{feedbackId} {
      allow write: if true; // PERMITE ESCRITA PARA QUALQUER PESSOA
      allow read: if request.auth != null && 
        exists(/databases/$(database)/documents/areas/$(resource.data.areaId)) &&
        get(/databases/$(database)/documents/areas/$(resource.data.areaId)).data.userId == request.auth.uid;
    }
  }
}

# üìã Como aplicar:
# 1. Acesse https://console.firebase.google.com/
# 2. Selecione seu projeto "pesquisou-ee03b"
# 3. V√° em "Firestore Database" no menu lateral
# 4. Clique na aba "Regras"
# 5. Substitua todo o conte√∫do pelas regras acima
# 6. Clique em "Publicar"
# 7. Aguarde alguns segundos para as regras serem aplicadas

# ‚úÖ Estas regras resolvem:
# - Permite que clientes enviem feedbacks sem login
# - Mant√©m seguran√ßa para leitura de feedbacks (apenas dono da √°rea)
# - Permite cria√ß√£o de usu√°rios e √°reas
# - Resolve o erro "Missing or insufficient permissions"

# üß™ Para testar:
# 1. Aplique as regras acima
# 2. Acesse http://localhost:3000/test
# 3. Clique em "Testar Firestore"
# 4. Verifique se o documento √© criado com sucesso 